
@{
    ViewBag.Title = "Stock";
}

<h2>Stock Info</h2>

<form id="stockForm">
    <label for="stockInput">Input a Ticker</label><br />
    <input type="text" id="stockInput" name="stockInput" />
    <input type="submit" value="Submit" />
</form>

<table class="table table-bordered table-responsive table-hover" id="results">
    <tr>
        <th>Ticker</th>
        <th>Date</th>
        <th>Open</th>
        <th>High</th>
        <th>Low</th>
        <th>Close</th>
        <th>Volume</th>
    </tr>
</table>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>

    //TODO refactor duhhh and rename
    function compareClose(dayOne, dayTwo) {
        var closingData = "";
        if (dayOne > dayTwo) {
            
            return '<td id="close" class="data higher">' + dayOne + '</td>';
        }
        else {
            return '<td id="close" class="data lower">' + dayOne + '</td>';
        }
        
    }



    const key = 'JEZZ18QI4141C78H';

    $("#stockForm").submit(function (e) {

        e.preventDefault();

        var form = $(this);
        var url = form.attr('action');
        var ticker = $("#stockInput").val();
        var lastDay = "";
        $('.data').remove();


        $.ajax({ 
            type: "GET",
            url: "https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=" + ticker + "&apikey=" + key + "",
            dataType: "json",
            success: function (result) {
                var metadata = []
                var tempdata = []
                var stockdata = []
                var dates =[]
                $.each(result, function (index, day) {
                    metadata.push(day);
                });
                tempdata = metadata[1]
                
                var counter = 0

                //TODO break into seperate method and add number of days as param
                $.each(tempdata, function (index, day) {
                    
                    counter++;
                    if (counter < 7) {
                        dates.push(index);
                        stockdata.push(day);
                        
                    }
                    
                });

                
                var results = ""

                ticker = metadata[0]["2. Symbol"].toUpperCase();
               
                for (let i = 0; i < 5; i++) {
                    var openHtml = compareClose(stockdata[i]["1. open"], stockdata[i + 1]["1. open"]);
                    var highHtml = compareClose(stockdata[i]["2. high"], stockdata[i + 1]["2. high"]);
                    var closingHtml = compareClose(stockdata[i]["4. close"], stockdata[i + 1]["4. close"]);
                    var lowHtml = compareClose(stockdata[i]["3. low"], stockdata[i + 1]["3. low"]);
                    var volumeHtml = compareClose(stockdata[i]["5. volume"], stockdata[i + 1]["5. volume"]);
                    var results = ""
                    results += 
                        '<tr >' +
                    '<td id="ticker" class="data ticker">' + ticker + '</td>' +
                    '<td id="date" class="data date">' + dates[i] + '</td>' +
                        openHtml + 
                        highHtml +
                        lowHtml +
                        closingHtml +
                        volumeHtml +
                        '</tr>';
                    
                    $('#results').append(results);
                    
                }

                

            },
        });

        $("#stockInput").val('');

    });


</script>
<style>
    .higher{
        background-color: green;
    }
    .lower {
        background-color: red;
    }
    .ticker{
        background-color: lightgoldenrodyellow;
    }
    .date {
        background-color: lightgoldenrodyellow;
    }
</style>

